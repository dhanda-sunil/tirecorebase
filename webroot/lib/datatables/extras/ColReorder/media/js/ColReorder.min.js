/*
 * File:        ColReorder.nightly.min.js
 * Version:     1.1.0-dev
 * Author:      Allan Jardine (www.sprymedia.co.uk)
 * Info:        www.datatables.net
 * 
 * Copyright 2008-2012 Allan Jardine, all rights reserved.
 *
 * This source file is free software, under either the GPL v2 license or a
 * BSD style license, available at:
 *   http://datatables.net/license_gpl2
 *   http://datatables.net/license_bsd
 * 
 * This source file is distributed in the hope that it will be useful, but 
 * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY 
 * or FITNESS FOR A PARTICULAR PURPOSE. See the license files for details.
 */
(function(f,q,p){function n(a){for(var b=[],d=0,c=a.length;d<c;d++)b[a[d]]=d;return b}function l(a,b,d){b=a.splice(b,1)[0];a.splice(d,0,b)}function o(a,b,d){for(var c=[],e=0,g=a.childNodes.length;e<g;e++)a.childNodes[e].nodeType==1&&c.push(a.childNodes[e]);b=c[b];d!==null?a.insertBefore(b,c[d]):a.appendChild(b)}f.fn.dataTableExt.oApi.fnColReorder=function(a,b,d){var c,e,g,j,m=a.aoColumns.length,i;if(b!=d)if(b<0||b>=m)this.oApi._fnLog(a,1,"ColReorder 'from' index is out of bounds: "+b);else if(d<0||
d>=m)this.oApi._fnLog(a,1,"ColReorder 'to' index is out of bounds: "+d);else{var k=[];c=0;for(e=m;c<e;c++)k[c]=c;l(k,b,d);k=n(k);c=0;for(e=a.aaSorting.length;c<e;c++)a.aaSorting[c][0]=k[a.aaSorting[c][0]];if(a.aaSortingFixed!==null){c=0;for(e=a.aaSortingFixed.length;c<e;c++)a.aaSortingFixed[c][0]=k[a.aaSortingFixed[c][0]]}c=0;for(e=m;c<e;c++){i=a.aoColumns[c];g=0;for(j=i.aDataSort.length;g<j;g++)i.aDataSort[g]=k[i.aDataSort[g]]}if(a.aoColumns[b].bVisible){j=this.oApi._fnColumnIndexToVisible(a,b);
i=null;for(c=d<b?d:d+1;i===null&&c<m;){i=this.oApi._fnColumnIndexToVisible(a,c);c++}g=a.nTHead.getElementsByTagName("tr");c=0;for(e=g.length;c<e;c++)o(g[c],j,i);if(a.nTFoot!==null){g=a.nTFoot.getElementsByTagName("tr");c=0;for(e=g.length;c<e;c++)o(g[c],j,i)}c=0;for(e=a.aoData.length;c<e;c++)a.aoData[c].nTr!==null&&o(a.aoData[c].nTr,j,i)}l(a.aoColumns,b,d);l(a.aoPreSearchCols,b,d);c=0;for(e=a.aoData.length;c<e;c++)l(a.aoData[c]._anHidden,b,d);c=0;for(e=a.aoHeader.length;c<e;c++)l(a.aoHeader[c],b,d);
if(a.aoFooter!==null){c=0;for(e=a.aoFooter.length;c<e;c++)l(a.aoFooter[c],b,d)}c=0;for(e=m;c<e;c++){f(a.aoColumns[c].nTh).off("click");this.oApi._fnSortAttachListener(a,a.aoColumns[c].nTh,c)}f(a.oInstance).trigger("column-reorder",[a,{iFrom:b,iTo:d,aiInvertMapping:k}]);typeof a.oInstance._oPluginFixedHeader!="undefined"&&a.oInstance._oPluginFixedHeader.fnUpdate()}};var h=function(a,b){var d;if(a.fnSettings)d=a.fnSettings();else if(typeof a==="string"){if(f.fn.dataTable.fnIsDataTable(f(a)[0]))d=f(a).eq(0).dataTable().fnSettings()}else if(a.nodeName&&
a.nodeName.toLowerCase()==="table"){if(f.fn.dataTable.fnIsDataTable(a.nodeName))d=f(a.nodeName).dataTable().fnSettings()}else if(a instanceof jQuery){if(f.fn.dataTable.fnIsDataTable(a[0]))d=a.eq(0).dataTable().fnSettings()}else d=a;if(this instanceof h===false){a=0;for(b=h.aoInstances.length;a<b;a++)if(h.aoInstances[a].s.dt==d)return h.aoInstances[a];return null}this.s={dt:null,init:f.extend(true,{},h.defaults,b),fixed:0,fixedRight:0,dropCallback:null,mouse:{startX:-1,startY:-1,offsetX:-1,offsetY:-1,
target:-1,targetIndex:-1,fromIndex:-1},aoTargets:[]};this.dom={drag:null,pointer:null};this.s.dt=d.oInstance.fnSettings();this._fnConstruct();d.oApi._fnCallbackReg(d,"aoDestroyCallback",f.proxy(this._fnDestroy,this),"ColReorder");h.aoInstances.push(this);return this};h.prototype={fnReset:function(){for(var a=[],b=0,d=this.s.dt.aoColumns.length;b<d;b++)a.push(this.s.dt.aoColumns[b]._ColReorder_iOrigCol);this._fnOrderColumns(a);return this},fnGetCurrentOrder:function(){return this.fnOrder()},fnOrder:function(a){if(a===
undefined){a=[];for(var b=0,d=this.s.dt.aoColumns.length;b<d;b++)a.push(this.s.dt.aoColumns[b]._ColReorder_iOrigCol);return a}this._fnOrderColumns(n(a));return this},_fnConstruct:function(){var a=this,b=this.s.dt.aoColumns.length,d;if(this.s.init.iFixedColumns)this.s.fixed=this.s.init.iFixedColumns;this.s.fixedRight=this.s.init.iFixedColumnsRight?b-this.s.init.iFixedColumnsRight:b;if(this.s.init.fnReorderCallback)this.s.dropCallback=this.s.init.fnReorderCallback;for(d=0;d<b;d++){d>this.s.fixed-1&&
d<this.s.fixedRight&&this._fnMouseListener(d,this.s.dt.aoColumns[d].nTh);this.s.dt.aoColumns[d]._ColReorder_iOrigCol=d}this.s.dt.oApi._fnCallbackReg(this.s.dt,"aoStateSaveParams",function(g,j){a._fnStateSave.call(a,j)},"ColReorder_State");var c=null;if(this.s.init.aiOrder)c=this.s.init.aiOrder.slice();if(this.s.dt.oLoadedState&&typeof this.s.dt.oLoadedState.ColReorder!="undefined"&&this.s.dt.oLoadedState.ColReorder.length==this.s.dt.aoColumns.length)c=this.s.dt.oLoadedState.ColReorder;if(c)if(a.s.dt._bInitComplete){b=
n(c);a._fnOrderColumns.call(a,b)}else{var e=false;this.s.dt.aoDrawCallback.push({fn:function(){if(!a.s.dt._bInitComplete&&!e){e=true;var g=n(c);a._fnOrderColumns.call(a,g)}},sName:"ColReorder_Pre"})}},_fnOrderColumns:function(a){if(a.length!=this.s.dt.aoColumns.length)this.s.dt.oInstance.oApi._fnLog(this.s.dt,1,"ColReorder - array reorder does not match known number of columns. Skipping.");else{for(var b=0,d=a.length;b<d;b++){var c=f.inArray(b,a);if(b!=c){l(a,c,b);this.s.dt.oInstance.fnColReorder(c,
b)}}if(this.s.dt.oScroll.sX!==""||this.s.dt.oScroll.sY!=="")this.s.dt.oInstance.fnAdjustColumnSizing();this.s.dt.oInstance.oApi._fnSaveState(this.s.dt)}},_fnStateSave:function(a){var b,d,c,e=this.s.dt;for(b=0;b<a.aaSorting.length;b++)a.aaSorting[b][0]=e.aoColumns[a.aaSorting[b][0]]._ColReorder_iOrigCol;var g=f.extend(true,[],a.aoSearchCols);a.ColReorder=[];b=0;for(d=e.aoColumns.length;b<d;b++){c=e.aoColumns[b]._ColReorder_iOrigCol;a.aoSearchCols[c]=g[b];a.abVisCols[c]=e.aoColumns[b].bVisible;a.ColReorder.push(c)}},
_fnMouseListener:function(a,b){var d=this;f(b).on("mousedown.ColReorder",function(c){c.preventDefault();d._fnMouseDown.call(d,c,b)})},_fnMouseDown:function(a){var b=this,d=f(a.target).closest("th, td"),c=d.offset(),e=f.inArray(d[0],f.map(this.s.dt.aoColumns,function(g){return g.nTh}));if(e!==-1){this.s.mouse.startX=a.pageX;this.s.mouse.startY=a.pageY;this.s.mouse.offsetX=a.pageX-c.left;this.s.mouse.offsetY=a.pageY-c.top;this.s.mouse.target=d[0];this.s.mouse.targetIndex=e;this.s.mouse.fromIndex=e;
this._fnRegions();f(p).on("mousemove.ColReorder",function(g){b._fnMouseMove.call(b,g)}).on("mouseup.ColReorder",function(g){b._fnMouseUp.call(b,g)})}},_fnMouseMove:function(a){if(this.dom.drag===null){if(Math.pow(Math.pow(a.pageX-this.s.mouse.startX,2)+Math.pow(a.pageY-this.s.mouse.startY,2),0.5)<5)return;this._fnCreateDragNode()}this.dom.drag.css({left:a.pageX-this.s.mouse.offsetX,top:a.pageY-this.s.mouse.offsetY});for(var b=false,d=this.s.mouse.toIndex,c=1,e=this.s.aoTargets.length;c<e;c++)if(a.pageX<
this.s.aoTargets[c-1].x+(this.s.aoTargets[c].x-this.s.aoTargets[c-1].x)/2){this.dom.pointer.css("left",this.s.aoTargets[c-1].x);this.s.mouse.toIndex=this.s.aoTargets[c-1].to;b=true;break}if(!b){this.dom.pointer.css("left",this.s.aoTargets[this.s.aoTargets.length-1].x);this.s.mouse.toIndex=this.s.aoTargets[this.s.aoTargets.length-1].to}if(this.s.init.bRealtime&&d!==this.s.mouse.toIndex){this.s.dt.oInstance.fnColReorder(this.s.mouse.fromIndex,this.s.mouse.toIndex);this.s.mouse.fromIndex=this.s.mouse.toIndex;
this._fnRegions()}},_fnMouseUp:function(){f(p).off("mousemove.ColReorder mouseup.ColReorder");if(this.dom.drag!==null){this.dom.drag.remove();this.dom.pointer.remove();this.dom.drag=null;this.dom.pointer=null;this.s.dt.oInstance.fnColReorder(this.s.mouse.fromIndex,this.s.mouse.toIndex);if(this.s.dt.oScroll.sX!==""||this.s.dt.oScroll.sY!=="")this.s.dt.oInstance.fnAdjustColumnSizing();this.s.dropCallback!==null&&this.s.dropCallback.call(this);this.s.dt.oInstance.oApi._fnSaveState(this.s.dt)}},_fnRegions:function(){var a=
this.s.dt.aoColumns;this.s.aoTargets.splice(0,this.s.aoTargets.length);this.s.aoTargets.push({x:f(this.s.dt.nTable).offset().left,to:0});for(var b=0,d=0,c=a.length;d<c;d++){d!=this.s.mouse.fromIndex&&b++;a[d].bVisible&&this.s.aoTargets.push({x:f(a[d].nTh).offset().left+f(a[d].nTh).outerWidth(),to:b})}this.s.fixedRight!==0&&this.s.aoTargets.splice(this.s.fixedRight+1);this.s.fixed!==0&&this.s.aoTargets.splice(0,this.s.fixed)},_fnCreateDragNode:function(){var a=this.s.dt.oScroll.sX!==""||this.s.dt.oScroll.sY!==
"",b=this.s.dt.aoColumns[this.s.mouse.targetIndex].nTh,d=b.parentNode,c=d.parentNode,e=c.parentNode,g=f(b).clone();this.dom.drag=f(e.cloneNode(false)).addClass("DTCR_clonedTable").append(c.cloneNode(false).appendChild(d.cloneNode(false).appendChild(g[0]))).css({position:"absolute",top:0,left:0,width:f(b).outerWidth(),height:f(b).outerHeight()}).appendTo("body");this.dom.pointer=f("<div></div>").addClass("DTCR_pointer").css({position:"absolute",top:a?f("div.dataTables_scroll",this.s.dt.nTableWrapper).offset().top:
f(this.s.dt.nTable).offset().top,height:a?f("div.dataTables_scroll",this.s.dt.nTableWrapper).height():f(this.s.dt.nTable).height()}).appendTo("body")},_fnDestroy:function(){var a,b;a=0;for(b=this.s.dt.aoDrawCallback.length;a<b;a++)if(this.s.dt.aoDrawCallback[a].sName==="ColReorder_Pre"){this.s.dt.aoDrawCallback.splice(a,1);break}a=0;for(b=h.aoInstances.length;a<b;a++)if(h.aoInstances[a]===this){h.aoInstances.splice(a,1);break}f(this.s.dt.nTHead).find("*").off(".ColReorder");this.s=this.s.dt.oInstance._oPluginColReorder=
null}};h.aoInstances=[];h.defaults={aiOrder:null,bRealtime:false,iFixedColumns:0,iFixedColumnsRight:0,fnReorderCallback:null};h.fnReset=function(a){for(var b=0,d=h.aoInstances.length;b<d;b++)h.aoInstances[b].s.dt.oInstance==a&&h.aoInstances[b].fnReset()};h.VERSION="1.1.0-dev";h.prototype.VERSION=h.VERSION;typeof f.fn.dataTable=="function"&&typeof f.fn.dataTableExt.fnVersionCheck=="function"&&f.fn.dataTableExt.fnVersionCheck("1.9.3")?f.fn.dataTableExt.aoFeatures.push({fnInit:function(a){var b=a.oInstance;
if(b._oPluginColReorder===undefined)b._oPluginColReorder=new h(a,a.oInit.oColReorder!==undefined?a.oInit.oColReorder:{});else b.oApi._fnLog(a,1,"ColReorder attempted to initialise twice. Ignoring second");return null},cFeature:"R",sFeature:"ColReorder"}):alert("Warning: ColReorder requires DataTables 1.9.3 or greater - www.datatables.net/download");q.ColReorder=h;f.fn.dataTable.ColReorder=h})(jQuery,window,document);